\ProvidesPackage{prism}

\RequirePackage{xcolor}
\RequirePackage{etoolbox}

% -----------------------------
% Definizione colori
% -----------------------------
\definecolor{keywordblack}{RGB}{0,0,0}
\definecolor{varred}{RGB}{255,0,0}
\definecolor{commentgreen}{RGB}{0,128,0}
\definecolor{numblue}{RGB}{0,0,255}
\definecolor{dotblack}{RGB}{0,0,0}
\definecolor{gray}{RGB}{128,128,128}

\newcommand{\lt}{\textless}
\newcommand{\gt}{\textgreater}
\newcommand{\n}[1]{\numberb{#1}}

% -----------------------------
% Comandi personalizzati
% -----------------------------
\newcommand{\keyword}[1]{\textbf{\textcolor{keywordblack}{#1}}}
\newcommand{\variable}[1]{\textcolor{varred}{#1}}
\newcommand{\numberb}[1]{\textcolor{numblue}{#1}}
\newcommand{\cmt}[1]{\textcolor{commentgreen}{#1}}
\newcommand{\dotblack}[1]{\textcolor{dotblack}{#1}}

% -----------------------------
% Evidenziare contenuto tra parentesi quadre
% -----------------------------
\newcommand{\bracketcontent}[1]{%
    [% 
    \begingroup
        \def\do##1{%
            \ifcat 0##1\relax
                \numberb{##1}% se è un numero → blu
            \else
                \variable{##1}% altrimenti rosso
            \fi
        }%
        \docsvlist{#1}% 
    \endgroup
    ]%
}

% -----------------------------
% Contatore globale per numeri di riga Prism
% -----------------------------
\newcounter{prismline}

\newenvironment{highlightPrism}
{%
  \begingroup
  \ttfamily\small
  \parindent=0pt
  \obeyspaces
  \catcode`\_=12
  \catcode`\&=12
  \catcode`\<=12
  \catcode`\>=12
  \setcounter{prismline}{1}

  % comando per stampare numero di riga
  \newcommand{\printline}{%
    \llap{\textcolor{gray}{\theprismline\hspace{0.7em}}}%
    \stepcounter{prismline}%
  }%

  % aggiunge numero di riga all’inizio di ogni paragrafo
  \everypar{\printline\everypar{}}%

  % ridefinisco \\ per continuare numerazione su righe successive
  \let\oldcr\\
  \renewcommand{\\}{\oldcr\printline}%
}
{%
  \par
  \endgroup
}





